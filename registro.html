<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap"
      rel="stylesheet"
    />
    <!-- Bootstrap CSS -->

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <link
      href="https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://igniteyourgratitude.com/style.css" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>New Pledge</title>
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div class="row">
      <div class="col">
        <img
          class="logo"
          src="http://igniteyourgratitude.com/img/monat-gratitude-logo-w.png"
          alt=""
          height="160"
          width="160"
          align="left"
        />
      </div>
    </div>
    <div class="col" style="text-align:center;margin-bottom:10px;">
      <span class="form-title">MAKE AN IMPACT</span>
    </div>

    <div class="formcontainer">
      <form id="send_user">
        <div class="form-group">
          <label>
            First Name <br />
            <input type="text" id="first_name" placeholder="" />
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            Last Name <br />
            <input type="text" id="last_name" placeholder="" />
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            Email <br />
            <input
              type="email"
              id="email"
              placeholder=""
              style="width: 300px;"
            />
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            City <br />
            <input type="text" id="city" placeholder="" style="width: 300px;" />
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            State <br />
            <input
              type="text"
              id="state"
              placeholder=""
              style="width: 300px;"
            />
          </label>
        </div>
        <br />
        <div class="form-group">
          <label
            >Country<br />
            <select id="country">
              <option value="UNITED STATES">UNITED STATES</option>
              <option value="CANADA">CANADA</option>
              <option value="UK">UK</option>
            </select>
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            How many volunteer hours do you pledge to complete between today and
            MONATions 2019? <br />
            <input type="number" id="hours" placeholder="" required />
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            What has inspired you to take action in your community and join the
            #MONATGratitude movement? <br />
            <textarea
              type="text"
              id="inspirations"
              placeholder=""
              rows="3"
              style="width: 300px;"
            ></textarea>
          </label>
        </div>
        <br />
        <div class="form-group">
          <label>
            How will you practice #LivinginGratitude this year? <br />
            <textarea
              type="text"
              id="practice"
              placeholder=""
              rows="3"
              style="width: 300px;"
            ></textarea>
          </label>
        </div>
        <br />

        <button type="submit" class="btn btn-primary">
          Send
        </button>
      </form>
    </div>
    <script>
      const refreshToken = "1/9LhF_hC60Nr-nK7J8AAtbQ3Pfe_z1uQQVjzzUAzNR8s";
      const form = document.getElementById("send_user");
      const id = "1JWd9F36hEa92WuPwbEDEi2qVRciJIrJhW6ee2szmY58";

      const refreshTokenFetch = async () => {
        const fetchNewToken = await fetch(
          "https://www.googleapis.com/oauth2/v4/token",
          {
            method: "POST",
            body: JSON.stringify({
              client_id:
                "55915281188-r98e7eskr0rncpsanj341c9f6eahh17d.apps.googleusercontent.com",
              client_secret: "eR2gxAuZiZo2jeYGTHHxyuvM",
              redirect_uri: "http://igniteyourgratitude.com/registro.html",
              grant_type: "refresh_token",
              approval_prompt: "force",
              access_type: "offline",
              refresh_token: "1/9LhF_hC60Nr-nK7J8AAtbQ3Pfe_z1uQQVjzzUAzNR8s"
            })
          }
        );
        const data = await fetchNewToken.json();
        localStorage.setItem("token", data.access_token);
      };

      refreshTokenFetch();
      setInterval(refreshTokenFetch(), 2400000);

      form.addEventListener("submit", async e => {
        e.preventDefault();
        const first_name = document.getElementById("first_name").value;
        const last_name = document.getElementById("last_name").value;
        const email = document.getElementById("email").value;
        const city = document.getElementById("city").value;
        const state = document.getElementById("state").value;
        const country = document.getElementById("country").value;
        const hours = document.getElementById("hours").value;
        const practice = document.getElementById("practice").value;
        const inspirations = document.getElementById("inspirations").value;

        const urlSheet1 = `https://sheets.googleapis.com/v4/spreadsheets/${id}/values/Sheet1!E2`;
        const fetchTotalUsers = await fetch(urlSheet1, {
          method: "GET",
          headers: new Headers({
            Authorization: "Bearer " + localStorage.getItem("token")
          })
        });
        const getTotalUsers = await fetchTotalUsers.json();
        const totalUsers = parseInt(getTotalUsers.values, 10) + 1;
        const range = `A${totalUsers}:I${totalUsers}`;
        const urlSheet2 = `https://sheets.googleapis.com/v4/spreadsheets/${id}/values/Sheet2!${range}?valueInputOption=RAW`;
        const fetchSetUser = await fetch(urlSheet2, {
          method: "PUT",
          headers: new Headers({
            Authorization: "Bearer " + localStorage.getItem("token")
          }),
          body: JSON.stringify({
            majorDimension: "ROWS",
            values: [
              [
                first_name,
                last_name,
                email,
                city,
                state,
                country,
                parseInt(hours),
                practice,
                inspirations
              ]
            ]
          })
        });

        alert("Thanks!");
        form.reset();
        document.body.scrollTop = 0;
        document.documentElement.scrollTop = 0;
      });
    </script>
  </body>
</html>
